import{h as to,a as n,j as o,R as ro,g as p,l as ao}from"./GlobalStyles-Dqpp29B9.js";import{a as m}from"./axios-DnYME9kn.js";import{C as so,a as no,b as io,F as _,c as C,d as A,B as lo,e as L,I as co,f as T,L as M,g as R,h as uo,i as mo,j as ho,k as po,l as xo,N as go,D as jo,m as fo,n as J,o as _o,p as Co}from"./CategoriaProdutosStyle-Bi6KNH5F.js";import{c as Ao}from"./index-U_MZ96hN.js";import{y as Po,z as Fo,I as So,C as yo,B as O}from"./ProdutoStyles-Cz6hDj1C.js";import{T as bo,a as vo,d as Bo}from"./index-CJGrLZTX.js";import{U as ko}from"./userContext-Hfd7AKwO.js";import{c as q,f as Eo,b as $o}from"./Functions-BNM27soa.js";import{S as Io}from"./SpinnerComponent-D-z1JUIS.js";function Go(){const{search:G}=to(),c=new URLSearchParams(G).get("query"),[U,z]=n.useState([]),[H,P]=n.useState(!0),[F,V]=n.useState(null),{user:d}=n.useContext(ko),[S,y]=n.useState(null),[h,x]=n.useState(""),[b,v]=n.useState(""),[B,k]=n.useState(""),[g,j]=n.useState({});n.useEffect(()=>{if(d&&d.id_user){const t=(JSON.parse(localStorage.getItem(`listaAmei_${d.id_user}`))||[]).reduce((a,i)=>(a[i.id_produto]=!0,a),{});j(t)}},[d]);const E=((e,t,a,i,l)=>{let s=e;return t&&(s=s.filter(r=>r.cor_produto===t)),a&&(s=s.filter(r=>r.tamanho_produto===a)),i&&l&&(s=s.filter(r=>r.preco_produto>=i&&r.preco_produto<=l)),s})(U,S,h,b,B),f=8,[u,K]=n.useState(1),$=(u-1)*f,Q=$+f,I=E.slice($,Q),D=Math.ceil(E.length/f),N=e=>{K(e)};n.useEffect(()=>{c&&(async()=>{try{P(!0);const[t,a]=await Promise.all([m.get(`http://localhost:3001/aurea/busca/nome/${c}`),m.get(`http://localhost:3001/aurea/busca/categoria/${c}`)]),i=t.data.result||[],l=a.data.result||[],s=[...new Map(i.concat(l).map(r=>[r.id_produto,r])).values()];z(s)}catch{V("Erro ao buscar produtos. Tente novamente mais tarde.")}finally{P(!1)}})()},[c]);const W=[{nome:"amarelo",cor:"#FFF800"},{nome:"azul",cor:"#007BFF"},{nome:"branco",cor:"#fff"},{nome:"cinza",cor:"#737373"},{nome:"laranja",cor:"#FA5400"},{nome:"marrom",cor:"#8C5900"},{nome:"nude",cor:"#F2D2BD"},{nome:"preto",cor:"#000"},{nome:"rosa",cor:"#FFDBDB"},{nome:"rosê",cor:"#C21E56"},{nome:"roxo",cor:"#A347FF"},{nome:"verde",cor:"#00AD1D"},{nome:"vermelho",cor:"#8C0000"}],w=e=>{x(e)},X=[{tamanho:"PP"},{tamanho:"P"},{tamanho:"M"},{tamanho:"G"},{tamanho:"GG"}],Y=async e=>{try{const t=d.id_user;if(!t){alert('Você precisa estar logado para adicionar à lista "Amei".');return}const a=JSON.parse(localStorage.getItem(`listaAmei_${t}`))||[];if(a.some(r=>r.id_produto===e.id_produto)||(await m.get(`http://localhost:3001/aurea/lista-amei/${t}`)).data.some(r=>r.id_produto===e.id_produto))return;const s=await m.post("http://localhost:3001/aurea/lista-amei",{id_user:t,id_produto:e.id_produto});if(s.status!==200&&s.status!==201)throw new Error('Erro ao adicionar o produto à lista "Amei".');a.push(e),localStorage.setItem(`listaAmei_${t}`,JSON.stringify(a)),j(r=>({...r,[e.id_produto]:!0}))}catch(t){console.error('Erro ao adicionar à lista "Amei":',t.response?t.response.data:t.message),alert("Erro ao adicionar o produto à lista.")}},Z=async e=>{try{const t=d.id_user;await m.delete(`http://localhost:3001/aurea/lista-amei/${t}/${e}`);const i=(JSON.parse(localStorage.getItem(`listaAmei_${t}`))||[]).filter(l=>l.id_produto!==e);localStorage.setItem(`listaAmei_${t}`,JSON.stringify(i)),j(l=>({...l,[e]:!1}))}catch(t){console.error('Erro ao remover produto da lista "Amei":',t),alert("Erro ao remover o produto da lista.")}},oo=`Busca de ${q(c)}`,eo=`Estes são todos os resultados da sua busca de ${q(c)}`;return H?o.jsx(Io,{}):F?o.jsx("p",{children:F}):o.jsxs(ro.Fragment,{children:[o.jsx(Po,{children:oo}),o.jsx(Fo,{children:eo}),o.jsxs(so,{children:[o.jsxs(no,{children:[o.jsxs(io,{children:[o.jsxs(_,{children:[o.jsx(p,{style:{color:"#A87826"},children:"Filtrar por cor"}),o.jsx(C,{children:o.jsx(A,{children:W.map(({nome:e,cor:t})=>o.jsx(lo,{style:{backgroundColor:t,border:S===e?"2px solid #A87826":"none"},onClick:()=>y(e)},e))})})]}),o.jsxs(_,{children:[o.jsx(p,{style:{color:"#A87826"},children:"Filtrar por tamanho"}),o.jsxs(C,{children:[o.jsx(A,{children:X.map(({tamanho:e})=>o.jsx(L,{onClick:()=>w(e),style:h===e?{backgroundColor:"#A87826",color:"#fff"}:{},children:e},e))}),o.jsx(L,{onClick:()=>w("único"),style:h==="único"?{backgroundColor:"#A87826",color:"#fff",width:"3rem"}:{width:"3rem"},children:"Único"}),o.jsx(co,{type:"number",placeholder:"Nº",value:h,onChange:e=>x(e.target.value)})]})]}),o.jsxs(_,{children:[o.jsx(p,{style:{color:"#A87826"},children:"Filtrar por preço"}),o.jsx(C,{children:o.jsxs(A,{children:[o.jsxs(T,{children:[o.jsx(M,{children:"Mínimo"}),o.jsx(R,{type:"text",value:b,placeholder:"0",onChange:e=>v(e.target.value)})]}),o.jsx(p,{style:{margin:"2.2rem 0 0 0",color:"#A87826"},children:o.jsx(Ao,{})}),o.jsxs(T,{children:[o.jsx(M,{children:"Máximo"}),o.jsx(R,{type:"text",value:B,placeholder:"3000",onChange:e=>k(e.target.value)})]})]})})]})]}),o.jsx(uo,{onClick:()=>{y(null),x(""),v(""),k("")},children:"Remover Filtros"})]}),o.jsx(mo,{children:o.jsxs(ho,{children:[I.length>0?I.map(e=>o.jsxs(po,{children:[e.img_produto&&o.jsx(So,{src:`http://localhost:3001/uploads/${e.img_produto}`,alt:e.nome_produto}),o.jsxs(xo,{children:[e.nome_produto&&o.jsx(go,{children:e.nome_produto}),o.jsxs(jo,{children:[e.preco_produto&&o.jsx("p",{style:{color:"#A87826"},children:Eo(e.preco_produto)}),e.parcela_produto&&o.jsx("p",{style:{color:"#A87826"},children:$o(e.parcela_produto)})]}),o.jsxs(fo,{children:[o.jsx(J,{title:g[e.id_produto]?'Remover da lista "Amei"':'Adicionar à lista "Amei"',onClick:()=>g[e.id_produto]?Z(e.id_produto):Y(e),children:g[e.id_produto]?o.jsx(bo,{}):o.jsx(vo,{})}),o.jsx(J,{title:'Adicionar ao ""meu carrinho"',children:o.jsx(Bo,{})})]}),e.qtd_produto===0?o.jsx(_o,{style:{background:"#FFF",color:"#A87826"},children:"Avise quando chegar"}):o.jsx(Co,{to:`/produto/${e.nome_produto}`,children:"Detalhes do produto"})]})]},e.id_produto)):o.jsx("p",{children:"Nenhum produto encontrado com os filtros aplicados."}),o.jsxs(yo,{children:[o.jsx(O,{disabled:u===1,onClick:()=>N(u-1),children:"Anterior"}),o.jsxs(ao,{children:["Página ",u," de ",D]}),o.jsx(O,{disabled:u===D,onClick:()=>N(u+1),children:"Próxima"})]})]})})]})]})}export{Go as P};
