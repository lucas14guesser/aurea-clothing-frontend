import{a as s,m as io,j as o,C as no,k as A,g as v}from"./GlobalStyles-Dqpp29B9.js";import{d as lo,e as co,f as uo,g as po,D as ho,h as u,U as mo,i as m,j as _o,k as xo,l as q,m as jo,n as F,o as go,p as Ao,q as vo,r as fo,s as So,t as yo,C as Co,B as R}from"./ProdutoStyles-Cz6hDj1C.js";import{B as V}from"./HomePageStyles-CJMC4Gvw.js";import{a as d}from"./axios-DnYME9kn.js";import{U as Fo}from"./userContext-Hfd7AKwO.js";import{a as Eo,T as $o,c as Po,b as bo}from"./index-CJGrLZTX.js";import{f as p,b as ko,a as Lo}from"./Functions-BNM27soa.js";import{M as wo}from"./ModalAvisar-Y_GjLJ4T.js";import{d as Bo}from"./ModalsStyles-CkMaqKjX.js";import{F as k,B as H}from"./ContaUserStyles-jzYrjlID.js";import{d as G,e as Q}from"./ProdutosStyle-8Z2-wOEa.js";import{a as Io,d as Mo}from"./index-CmN5j4cY.js";function Ko(){const{user:i}=s.useContext(Fo),[f,Do]=s.useState({}),[S,No]=s.useState({}),{nome_produto:L}=io(),[r,z]=s.useState([]);s.useState([]);const[W,K]=s.useState([]),[E,w]=s.useState(""),[y,X]=s.useState(null),[B,Y]=s.useState(!1),[I,Z]=s.useState(!1),[_,$]=s.useState({}),[l,P]=s.useState({}),[C,oo]=s.useState([]),[h,M]=s.useState(1),x=5,D=(h-1)*x,ro=D+x,b=C.slice(D,ro),to=14;s.useEffect(()=>{(async()=>{try{const e=await d.get(`http://localhost:3001/aurea/produto/nome/${L}`);z(e.data.result)}catch(e){console.error("Erro ao buscar dados do produto.",e)}})()},[L]),s.useEffect(()=>{if(i&&i.id_user){const e=(JSON.parse(localStorage.getItem(`listaAmei_${i.id_user}`))||[]).reduce((a,n)=>(a[n.id_produto]=!0,a),{});$(e)}},[i]),s.useEffect(()=>{if(i&&i.id_user){const e=(JSON.parse(localStorage.getItem(`carrinho${i.id_user}`))||[]).reduce((a,n)=>(a[n.id_produto]=!0,a),{});P(e)}},[i]),s.useEffect(()=>{const t=async()=>{try{const a=await d.get(`http://localhost:3001/aurea/pedido/avaliacao-produto/${r.id_produto}`);oo(a.data.result)}catch(a){console.error("Erro ao listar avaliações",a)}},e=async()=>{try{const a=await d.get("http://localhost:3001/aurea/usuarios");K(a.data.result)}catch{setError("Erro ao obter dados dos clientes."),setSuccess("")}};t(),e()},[r.id_produto]);const ao=async t=>{const e=i.id_user;if(!e){alert('Você precisa estar logado para adicionar à lista "Amei".');return}try{const a=JSON.parse(localStorage.getItem(`listaAmei_${e}`))||[];if(a.some(g=>g.id_produto===t.id_produto)||(await d.get(`http://localhost:3001/aurea/lista-amei/${e}`)).data.some(g=>g.id_produto===t.id_produto))return;const c=await d.post("http://localhost:3001/aurea/lista-amei",{id_user:e,id_produto:t.id_produto});if(c.status!==200&&c.status!==201)throw new Error('Erro ao adicionar o produto à lista "Amei".');a.push(t),localStorage.setItem(`listaAmei_${e}`,JSON.stringify(a)),$(g=>({...g,[t.id_produto]:!0}))}catch(a){console.error('Erro ao adicionar à lista "Amei":',a.response?a.response.data:a.message),alert("Erro ao adicionar o produto à lista.")}},eo=async t=>{try{const e=i.id_user;await d.delete(`http://localhost:3001/aurea/lista-amei/${e}/${t}`);const n=(JSON.parse(localStorage.getItem(`listaAmei_${e}`))||[]).filter(j=>j.id_produto!==t);localStorage.setItem(`listaAmei_${e}`,JSON.stringify(n)),$(j=>({...j,[t]:!1}))}catch(e){console.error('Erro ao remover produto da lista "Amei":',e),alert("Erro ao remover o produto da lista.")}},N=async t=>{const e=i.id_user;if(!i||!i.id_user){alert("Você precisa estar logado para adicionar ao carrinho.");return}try{const a=JSON.parse(localStorage.getItem(`carrinho${e}`))||[];if(a.some(c=>c.id_produto===t.id_produto)||(await d.get(`http://localhost:3001/aurea/carrinho/${e}`)).data.some(c=>c.id_produto===t.id_produto))return;await d.post("http://localhost:3001/aurea/carrinho",{id_user:e,id_produto:t.id_produto,qtd_produto_carrinho:1}),a.push(t),localStorage.setItem(`carrinho${e}`,JSON.stringify(a)),P(c=>({...c,[t.id_produto]:!0}))}catch(a){console.error("Erro ao adicionar ao carrinho:",a),alert("Erro ao adicionar o produto no carrinho.")}},O=async t=>{try{await d.delete(`http://localhost:3001/aurea/carrinho/${i.id_user}/${t}`);const a=(JSON.parse(localStorage.getItem(`carrinho${i.id_user}`))||[]).filter(n=>n.id_produto!==t);localStorage.setItem(`carrinho${i.id_user}`,JSON.stringify(a)),P(n=>({...n,[t]:!1}))}catch(e){console.error("Erro ao remover produto do carrinho:",e),alert("Erro ao remover o produto do carrinho.")}},J=(t,e)=>{},T=(t,e)=>{},U=t=>{X(t),Y(!B)},so=async t=>{t.preventDefault(),Z(!0);const e={email_user:E,nome_produto:y.nome_produto};try{const a=await d.post(`http://localhost:3001/aurea/aviso/${y.nome_produto}`,e);a.status===200&&a.data.message==="E-mail enviado com sucesso!"?(alert("E-mail enviado com sucesso!"),w("")):alert(a.data.message||"Erro ao enviar e-mail.")}catch(a){console.error(a),(!a.response||a.response.status>=500)&&alert("Erro ao enviar e-mail.")}};return o.jsxs(no,{children:[o.jsx(lo,{children:r.nome_produto}),o.jsxs(co,{children:[o.jsxs(uo,{children:[o.jsx(po,{src:`http://localhost:3001/uploads/${r.img_produto}`,alt:r.nome_produto}),o.jsxs(ho,{children:[o.jsx(A,{children:r.nome_produto}),r.categoria_produto==="promocoes"?o.jsxs("div",{children:[o.jsx(u,{style:{textDecoration:"line-through"},children:p(r.preco_produto)}),o.jsx(u,{style:{color:"#A87826"},children:p(r.preco_promocional_produto)})]}):o.jsx(u,{children:p(r.preco_produto)}),o.jsx(v,{children:ko(r.parcela_produto)}),o.jsxs(v,{children:["Quantidade restante: ",r.qtd_produto]}),o.jsxs(mo,{children:[o.jsx("li",{children:o.jsx(m,{src:`http://localhost:3001/uploads/${r.img_produto}`,alt:r.nome_produto})}),o.jsx("li",{children:o.jsx(m,{src:`http://localhost:3001/uploads/${r.img_produto}`,alt:r.nome_produto})}),o.jsx("li",{children:o.jsx(m,{src:`http://localhost:3001/uploads/${r.img_produto}`,alt:r.nome_produto})}),o.jsx("li",{children:o.jsx(m,{src:`http://localhost:3001/uploads/${r.img_produto}`,alt:r.nome_produto})}),o.jsx("li",{children:o.jsx(m,{src:`http://localhost:3001/uploads/${r.img_produto}`,alt:r.nome_produto})}),o.jsx("li",{children:o.jsx(m,{src:`http://localhost:3001/uploads/${r.img_produto}`,alt:r.nome_produto})})]}),r.qtd_produto===0?o.jsxs(_o,{children:[o.jsx("p",{children:"Produto indisponível"}),o.jsx(V,{style:{background:"#FFF",color:"#A87826"},onClick:t=>{t.stopPropagation(),U(r)},children:"Avise quando chegar"})]}):o.jsxs(xo,{children:[o.jsxs(q,{title:_[r.id_produto]?'Remover da lista "Amei"':'Adicionar à lista "Amei"',onClick:()=>_[r.id_produto]?eo(r.id_produto):ao(r),onMouseEnter:()=>J(r.id_produto),onMouseLeave:()=>T(r.id_produto),style:{background:_[r.id_produto]?(f[r.id_produto],"#FFF"):f[r.id_produto]?"#FFF":"#A87826",color:_[r.id_produto]?(f[r.id_produto],"#A87826"):f[r.id_produto]?"#A87826":"#FFF"},children:[_[r.id_produto]?o.jsx(Eo,{}):o.jsx($o,{}),"Amei"]}),o.jsxs(q,{title:l[r.id_produto]?"Remover do carrinho":"Adicionar ao carrinho",onClick:()=>l[r.id_produto]?O(r.id_produto):N(r),onMouseEnter:()=>J(r.id_produto),onMouseLeave:()=>T(r.id_produto),style:{background:l[r.id_produto]?(S[r.id_produto],"#FFF"):S[r.id_produto]?"#FFF":"#A87826",color:l[r.id_produto]?(S[r.id_produto],"#A87826"):S[r.id_produto]?"#A87826":"#FFF"},children:[l[r.id_produto]?o.jsx(Po,{}):o.jsx(bo,{}),"Carrinho"]})]})]})]}),o.jsxs(jo,{children:[o.jsxs(F,{children:[o.jsx(A,{children:"Preço do produto:"}),r.categoria_produto==="promocoes"?o.jsxs("div",{children:[o.jsx(u,{style:{textDecoration:"line-through"},children:p(r.preco_produto)}),o.jsx(u,{style:{color:"#A87826"},children:p(r.preco_promocional_produto)})]}):o.jsx(u,{children:p(r.preco_produto)})]}),o.jsxs(F,{children:[o.jsx(A,{children:"Frete:"}),o.jsxs(F,{children:[o.jsxs(u,{children:["Grande Florianópolis: ",p(to)]}),o.jsx(u,{children:"Resto do Brasil: Necessário calcular."})]})]}),r.qtd_produto>0?o.jsx(F,{children:o.jsx(V,{title:l[r.id_produto]?"Remover do carrinho":"Adicionar no carrinho",onClick:()=>l[r.id_produto]?O(r.id_produto):N(r),children:l[r.id_produto]?"Remover do carrinho":"Adicionar ao carrinho"})}):o.jsx(v,{children:"Produto indisponível"})]})]}),B&&o.jsx(wo,{children:o.jsxs(Bo,{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[o.jsx(A,{children:"Preencha os campos"}),o.jsxs(k,{children:[o.jsx(G,{children:o.jsx(Io,{})}),o.jsx(Q,{type:"email",placeholder:"E-mail",value:E,onChange:t=>w(t.target.value)})]}),y&&o.jsxs(k,{children:[o.jsx(G,{children:o.jsx(Mo,{})}),o.jsx(Q,{type:"text",value:y.nome_produto,readOnly:!0})]}),o.jsxs(k,{children:[o.jsx(H,{type:"submit",onClick:so,disabled:I||!E,style:{width:"10rem"},children:I?"Enviando...":"Enviar"}),o.jsx(H,{onClick:U,style:{width:"10rem"},children:"Fechar"})]})]})}),o.jsxs(go,{children:[o.jsx(A,{children:"Avaliações do produto"}),Array.isArray(b)&&b.length>0?b.map(t=>{const e=W.find(n=>n.id_user===t.id_user),a=e?e.nome_user:"Cliente não encontrado";return o.jsxs(Ao,{children:[o.jsx(v,{children:a}),o.jsxs(vo,{children:["Avaliação realizada em: ",Lo(t.data_avaliacao)]}),o.jsxs(fo,{children:[o.jsx("div",{children:[1,2,3,4,5].map(n=>o.jsx(So,{$filled:n<=t.nivel_avaliacao,children:"★"},n))}),o.jsx(yo,{style:{fontWeight:"600"},children:t.titulo_avaliacao}),o.jsx(v,{children:t.descricao_avaliacao})]})]},t.id_avaliacao)}):o.jsx("p",{children:"Este produto ainda não possui avaliações"}),C.length>x&&o.jsxs(Co,{children:[o.jsx(R,{disabled:h===1,onClick:()=>M(h-1),children:"Anterior"}),o.jsxs("span",{children:["Página ",h," de ",Math.ceil(C.length/x)]}),o.jsx(R,{disabled:h===Math.ceil(C.length/x),onClick:()=>M(h+1),children:"Próxima"})]})]})]})}export{Ko as P};
