import{a as o,j as e,R,T as h,g as z,L as $}from"./GlobalStyles-Dqpp29B9.js";import{R as A,M as q,L as x,B as F}from"./UserDashboardStyles-BUujLACN.js";import{L as G}from"./PedidosAdminStyle-Ddg4UkdS.js";import{a as p}from"./axios-DnYME9kn.js";import{I as N,a as O}from"./index-CVGnD8mp.js";import{U as H}from"./userContext-Hfd7AKwO.js";import{a as J}from"./Functions-BNM27soa.js";import{C as K,B as D}from"./ProdutoStyles-Cz6hDj1C.js";import{C as Q,a as V,b as W,c as X,d as Y}from"./PedidoStyles-DLKgW4TH.js";function ce(){const{user:m,logout:E}=o.useContext(H),[j,M]=o.useState({}),[P,S]=o.useState([]),[b,y]=o.useState([]);o.useState("");const[Z,f]=o.useState(""),[c,k]=o.useState(!1),l=10,[r,B]=o.useState(1),a=o.useMemo(()=>P.filter(s=>s.status_pedido==="em andamento").sort((s,n)=>n.id_pedido-s.id_pedido),[P]),_=(r-1)*l,T=_+l,w=a.slice(_,T),C=Math.ceil(a.length/l),g=s=>{B(s)};o.useEffect(()=>{(async()=>{try{const n=await p.get("http://localhost:3001/aurea/pedidos");S(n.data.result);const d=await p.get("http://localhost:3001/aurea/usuarios");y(d.data.result)}catch{f("Erro ao obter dados.")}})()},[]),o.useEffect(()=>{const s=async()=>{try{const d=(await Promise.all(a.map(async t=>{if(!j[t.id_pedido]){const i=await p.get(`http://localhost:3001/aurea/itens-pedido/${t.id_pedido}`);return{id_pedido:t.id_pedido,itens:i.data.result}}return null}))).filter(Boolean).reduce((t,i)=>(t[i.id_pedido]=i.itens,t),{});M(t=>({...t,...d}))}catch{f("Erro ao obter dados dos itens do pedido.")}};a.length>0&&s()},[a]);const I=()=>{k(!c)};return e.jsxs(R.Fragment,{children:[c?e.jsxs(A,{children:[e.jsx(N,{style:{fontSize:"2rem",color:"#A87826",cursor:"pointer"},onClick:I}),e.jsxs(h,{children:["Boas-vindas, ",m.nome_user]})]}):e.jsxs(A,{children:[e.jsx(O,{style:{fontSize:"2rem",color:"#A87826",cursor:"pointer"},onClick:I}),e.jsxs(h,{children:["Boas-vindas, ",m.nome_user]})]}),c&&e.jsxs(q,{children:[e.jsx(x,{to:"/minha-conta",children:"Minha Conta"}),e.jsx(x,{to:"/pedidos-encerrados",children:"Pedidos Encerrados"}),e.jsx(x,{to:"/produtos",children:"Meus Produtos"}),e.jsx(F,{onClick:E,children:"Sair"})]}),e.jsxs(Q,{children:[e.jsx(h,{children:"Pedidos Ativos"}),e.jsx(z,{children:"Clique no ID do pedido para visualizá-lo."}),e.jsx(G,{children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(V,{children:"ID"}),e.jsx("th",{children:"Produto"}),e.jsx("th",{children:"Cliente"}),e.jsx(W,{children:"Data"}),e.jsx(X,{children:"Pagamento"}),e.jsx(Y,{children:"Status"})]})}),e.jsx("tbody",{children:w.slice().sort((s,n)=>n.id_pedido-s.id_pedido).map(s=>{const d=(j[s.id_pedido]||[]).reduce((u,L)=>u+L.qtd_produto,0),t=b.find(u=>u.id_user===s.id_user),i=t?t.nome_user:"Cliente não encontrado",U=t?t.sobrenome_user:"Cliente não encontrado",v=`${i} ${U}`;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx($,{to:`/pedido/${s.id_pedido}`,style:{textDecoration:"none",color:"#A87826"},children:s.id_pedido})}),e.jsx("td",{children:d>0?d+" Produto(s)":"Nenhum produto"}),e.jsx("td",{children:v}),e.jsx("td",{children:J(s.data_pedido)}),e.jsx("td",{children:s.pagamento_pedido}),e.jsx("td",{children:s.status_pedido})]},s.id_pedido)})})]})}),e.jsxs(K,{children:[e.jsx(D,{disabled:r===1,onClick:()=>g(r-1),children:"Anterior"}),e.jsxs("span",{children:["Página ",r," de ",C]}),e.jsx(D,{disabled:r===C,onClick:()=>g(r+1),children:"Próxima"})]})]})]})}export{ce as P};
