import{a as s,f as R,j}from"./GlobalStyles-Dqpp29B9.js";import{a as g}from"./axios-DnYME9kn.js";const f=s.createContext(),P=({children:E})=>{const[S,o]=s.useState(""),[p,r]=s.useState(!1),[I,i]=s.useState(!0),[U,a]=s.useState(null),[h,n]=s.useState(null),A=R(),x=()=>h==="admin",y=()=>h==="user";s.useEffect(()=>{(async()=>{var e;i(!0);try{const u=localStorage.getItem("token");if(u){const l=await g.get("http://localhost:3001/lex/auth/check",{withCredentials:!0,headers:{Authorization:`Bearer ${u}`}});if((e=l.data)!=null&&e.authenticated){const d=localStorage.getItem("userEmail")||l.data.email;o(d),r(!0),await c(d)}else o(""),r(!1),a(null)}else{const l=localStorage.getItem("isAuthenticated")==="true";if(r(l),l){const m=localStorage.getItem("userEmail");o(m),await c(m)}else o(""),a(null)}}catch(u){console.error("Erro ao verificar autenticação:",u),o(""),r(!1),a(null)}finally{i(!1)}})()},[]),s.useEffect(()=>{const t=localStorage.getItem("isAuthenticated")==="true";r(t)},[]);const c=async t=>{try{const e=await g.get(`http://localhost:3001/aurea/usuario/mail/${t}`);e.data.result.length>0?(a(e.data.result[0]),n(e.data.result[0].funcao_user)):(a(null),n(null))}catch{a(null),n(null)}finally{i(!1)}},v=async t=>{try{await c(t),o(t),r(!0),localStorage.setItem("userEmail",t),localStorage.setItem("isAuthenticated","true")}catch(e){console.error("Erro ao fazer login:",e),a(null),r(!1),localStorage.removeItem("isAuthenticated")}},w=t=>{o(t),localStorage.setItem("userEmail",t)},k=t=>{a(e=>({...e,...t}))},C=async()=>{try{await g.post("http://localhost:3001/aurea/auth/logout",{},{withCredentials:!0}),o(""),r(!1),a(null),n(null),localStorage.removeItem("userEmail"),localStorage.removeItem("isAuthenticated"),A("/login")}catch(t){console.error("Erro ao fazer logout",t)}};return j.jsx(f.Provider,{value:{user:U,userEmail:S,isAuthenticated:p,isLoading:I,userRole:h,login:v,logout:C,setUserEmail:w,updateUser:k,fetchUserData:c,isUserAdmin:x,isUserRegular:y},children:E})};function $(){return s.useContext(f)}export{f as U,P as a,$ as u};
