import{a as o,j as e,R,T as h,L as $}from"./GlobalStyles-Dqpp29B9.js";import{R as E,M as z,L as x,B as q}from"./UserDashboardStyles-BUujLACN.js";import{L as F}from"./PedidosAdminStyle-Ddg4UkdS.js";import{a as p}from"./axios-DnYME9kn.js";import{I as N,a as O}from"./index-CVGnD8mp.js";import{U as G}from"./userContext-Hfd7AKwO.js";import{a as H}from"./Functions-BNM27soa.js";import{C as J,B as M}from"./ProdutoStyles-Cz6hDj1C.js";import{C as K,a as Q,b as V,c as W,d as X}from"./PedidoStyles-DLKgW4TH.js";function ae(){const{user:m,logout:S}=o.useContext(G),[j,A]=o.useState([]),[P,D]=o.useState({});o.useState([]);const[b,y]=o.useState([]);o.useState("");const[Y,f]=o.useState(""),[c,k]=o.useState(!1),l=10,[r,B]=o.useState(1),a=o.useMemo(()=>j.filter(s=>s.status_pedido==="encerrado").sort((s,n)=>n.id_pedido-s.id_pedido),[j]),_=(r-1)*l,w=_+l,T=a.slice(_,w),C=Math.ceil(a.length/l),g=s=>{B(s)};o.useEffect(()=>{(async()=>{try{const n=await p.get("http://localhost:3001/aurea/pedidos");A(n.data.result);const d=await p.get("http://localhost:3001/aurea/usuarios");y(d.data.result)}catch{f("Erro ao obter dados.")}})()},[]),o.useEffect(()=>{const s=async()=>{try{const d=(await Promise.all(a.map(async t=>{if(!P[t.id_pedido]){const i=await p.get(`http://localhost:3001/aurea/itens-pedido/${t.id_pedido}`);return{id_pedido:t.id_pedido,itens:i.data.result}}return null}))).filter(Boolean).reduce((t,i)=>(t[i.id_pedido]=i.itens,t),{});D(t=>({...t,...d}))}catch{f("Erro ao obter dados dos itens do pedido.")}};a.length>0&&s()},[a]);const I=()=>{k(!c)};return e.jsxs(R.Fragment,{children:[c?e.jsxs(E,{children:[e.jsx(N,{style:{fontSize:"2rem",color:"#A87826",cursor:"pointer"},onClick:I}),e.jsxs(h,{children:["Boas-vindas, ",m.nome_user]})]}):e.jsxs(E,{children:[e.jsx(O,{style:{fontSize:"2rem",color:"#A87826",cursor:"pointer"},onClick:I}),e.jsxs(h,{children:["Boas-vindas, ",m.nome_user]})]}),c&&e.jsxs(z,{children:[e.jsx(x,{to:"/minha-conta",children:"Minha Conta"}),e.jsx(x,{to:"/pedidos-ativos",children:"Pedidos Ativos"}),e.jsx(x,{to:"/produtos",children:"Meus Produtos"}),e.jsx(q,{onClick:S,children:"Sair"})]}),e.jsxs(K,{children:[e.jsx(h,{children:"Pedidos Encerrados"}),e.jsx(F,{children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(Q,{children:"ID"}),e.jsx("th",{children:"Produto"}),e.jsx("th",{children:"Cliente"}),e.jsx(V,{children:"Data"}),e.jsx(W,{children:"Pagamento"}),e.jsx(X,{children:"Status"})]})}),e.jsx("tbody",{children:T.slice().sort((s,n)=>n.id_pedido-s.id_pedido).map(s=>{const d=(P[s.id_pedido]||[]).reduce((u,v)=>u+v.qtd_produto,0),t=b.find(u=>u.id_user===s.id_user),i=t?t.nome_user:"Cliente não encontrado",U=t?t.sobrenome_user:"Cliente não encontrado",L=`${i} ${U}`;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx($,{to:`/pedido/${s.id_pedido}`,style:{textDecoration:"none",color:"#A87826"},children:s.id_pedido})}),e.jsx("td",{children:d>0?d+" Produto(s)":"Nenhum produto"}),e.jsx("td",{children:L}),e.jsx("td",{children:H(s.data_pedido)}),e.jsx("td",{children:s.pagamento_pedido}),e.jsx("td",{children:s.status_pedido})]},s.id_pedido)})})]})}),e.jsxs(J,{children:[e.jsx(M,{disabled:r===1,onClick:()=>g(r-1),children:"Anterior"}),e.jsxs("span",{children:["Página ",r," de ",C]}),e.jsx(M,{disabled:r===C,onClick:()=>g(r+1),children:"Próxima"})]})]})]})}export{ae as P};
