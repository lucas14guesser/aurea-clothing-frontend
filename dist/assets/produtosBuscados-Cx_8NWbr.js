import{h as te,a as n,j as e,R as re,g as p,l as ae}from"./GlobalStyles-Dqpp29B9.js";import{a as m}from"./axios-DnYME9kn.js";import{C as se,a as ne,b as ie,F as b,c as _,d as C,B as ce,e as L,I as le,f as T,L as M,g as R,h as de,i as ue,j as me,k as he,l as pe,N as xe,D as ge,m as je,n as J,o as fe,p as be}from"./CategoriaProdutosStyle-Bi6KNH5F.js";import{c as _e}from"./index-U_MZ96hN.js";import{y as Ce,z as Ae,I as Pe,C as Fe,B as O}from"./ProdutoStyles-Cz6hDj1C.js";import{T as Se,a as ke,d as ye}from"./index-CJGrLZTX.js";import{U as ve}from"./userContext-D66xfPlX.js";import{c as q,f as Be,b as Ee}from"./Functions-C5TbUWjh.js";import{S as $e}from"./SpinnerComponent-D-z1JUIS.js";function qe(){const{search:G}=te(),l=new URLSearchParams(G).get("query"),[U,z]=n.useState([]),[H,A]=n.useState(!0),[P,V]=n.useState(null),{user:d}=n.useContext(ve),[F,S]=n.useState(null),[h,x]=n.useState(""),[k,y]=n.useState(""),[v,B]=n.useState(""),[g,j]=n.useState({});n.useEffect(()=>{if(d&&d.id_user){const t=(JSON.parse(localStorage.getItem(`listaAmei_${d.id_user}`))||[]).reduce((a,i)=>(a[i.id_produto]=!0,a),{});j(t)}},[d]);const E=((o,t,a,i,c)=>{let s=o;return t&&(s=s.filter(r=>r.cor_produto===t)),a&&(s=s.filter(r=>r.tamanho_produto===a)),i&&c&&(s=s.filter(r=>r.preco_produto>=i&&r.preco_produto<=c)),s})(U,F,h,k,v),f=8,[u,K]=n.useState(1),$=(u-1)*f,Q=$+f,I=E.slice($,Q),D=Math.ceil(E.length/f),N=o=>{K(o)};n.useEffect(()=>{l&&(async()=>{try{A(!0);const[t,a]=await Promise.all([m.get(`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/busca/nome/${l}`),m.get(`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/busca/categoria/${l}`)]),i=t.data.result||[],c=a.data.result||[],s=[...new Map(i.concat(c).map(r=>[r.id_produto,r])).values()];z(s)}catch{V("Erro ao buscar produtos. Tente novamente mais tarde.")}finally{A(!1)}})()},[l]);const W=[{nome:"amarelo",cor:"#FFF800"},{nome:"azul",cor:"#007BFF"},{nome:"branco",cor:"#fff"},{nome:"cinza",cor:"#737373"},{nome:"laranja",cor:"#FA5400"},{nome:"marrom",cor:"#8C5900"},{nome:"nude",cor:"#F2D2BD"},{nome:"preto",cor:"#000"},{nome:"rosa",cor:"#FFDBDB"},{nome:"rosê",cor:"#C21E56"},{nome:"roxo",cor:"#A347FF"},{nome:"verde",cor:"#00AD1D"},{nome:"vermelho",cor:"#8C0000"}],w=o=>{x(o)},X=[{tamanho:"PP"},{tamanho:"P"},{tamanho:"M"},{tamanho:"G"},{tamanho:"GG"}],Y=async o=>{try{const t=d.id_user;if(!t){alert('Você precisa estar logado para adicionar à lista "Amei".');return}const a=JSON.parse(localStorage.getItem(`listaAmei_${t}`))||[];if(a.some(r=>r.id_produto===o.id_produto)||(await m.get(`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/lista-amei/${t}`)).data.some(r=>r.id_produto===o.id_produto))return;const s=await m.post("https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/lista-amei",{id_user:t,id_produto:o.id_produto});if(s.status!==200&&s.status!==201)throw new Error('Erro ao adicionar o produto à lista "Amei".');a.push(o),localStorage.setItem(`listaAmei_${t}`,JSON.stringify(a)),j(r=>({...r,[o.id_produto]:!0}))}catch(t){console.error('Erro ao adicionar à lista "Amei":',t.response?t.response.data:t.message),alert("Erro ao adicionar o produto à lista.")}},Z=async o=>{try{const t=d.id_user;await m.delete(`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/lista-amei/${t}/${o}`);const i=(JSON.parse(localStorage.getItem(`listaAmei_${t}`))||[]).filter(c=>c.id_produto!==o);localStorage.setItem(`listaAmei_${t}`,JSON.stringify(i)),j(c=>({...c,[o]:!1}))}catch(t){console.error('Erro ao remover produto da lista "Amei":',t),alert("Erro ao remover o produto da lista.")}},ee=`Busca de ${q(l)}`,oe=`Estes são todos os resultados da sua busca de ${q(l)}`;return H?e.jsx($e,{}):P?e.jsx("p",{children:P}):e.jsxs(re.Fragment,{children:[e.jsx(Ce,{children:ee}),e.jsx(Ae,{children:oe}),e.jsxs(se,{children:[e.jsxs(ne,{children:[e.jsxs(ie,{children:[e.jsxs(b,{children:[e.jsx(p,{style:{color:"#A87826"},children:"Filtrar por cor"}),e.jsx(_,{children:e.jsx(C,{children:W.map(({nome:o,cor:t})=>e.jsx(ce,{style:{backgroundColor:t,border:F===o?"2px solid #A87826":"none"},onClick:()=>S(o)},o))})})]}),e.jsxs(b,{children:[e.jsx(p,{style:{color:"#A87826"},children:"Filtrar por tamanho"}),e.jsxs(_,{children:[e.jsx(C,{children:X.map(({tamanho:o})=>e.jsx(L,{onClick:()=>w(o),style:h===o?{backgroundColor:"#A87826",color:"#fff"}:{},children:o},o))}),e.jsx(L,{onClick:()=>w("único"),style:h==="único"?{backgroundColor:"#A87826",color:"#fff",width:"3rem"}:{width:"3rem"},children:"Único"}),e.jsx(le,{type:"number",placeholder:"Nº",value:h,onChange:o=>x(o.target.value)})]})]}),e.jsxs(b,{children:[e.jsx(p,{style:{color:"#A87826"},children:"Filtrar por preço"}),e.jsx(_,{children:e.jsxs(C,{children:[e.jsxs(T,{children:[e.jsx(M,{children:"Mínimo"}),e.jsx(R,{type:"text",value:k,placeholder:"0",onChange:o=>y(o.target.value)})]}),e.jsx(p,{style:{margin:"2.2rem 0 0 0",color:"#A87826"},children:e.jsx(_e,{})}),e.jsxs(T,{children:[e.jsx(M,{children:"Máximo"}),e.jsx(R,{type:"text",value:v,placeholder:"3000",onChange:o=>B(o.target.value)})]})]})})]})]}),e.jsx(de,{onClick:()=>{S(null),x(""),y(""),B("")},children:"Remover Filtros"})]}),e.jsx(ue,{children:e.jsxs(me,{children:[I.length>0?I.map(o=>e.jsxs(he,{children:[o.img_produto&&e.jsx(Pe,{src:`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/uploads/${o.img_produto}`,alt:o.nome_produto}),e.jsxs(pe,{children:[o.nome_produto&&e.jsx(xe,{children:o.nome_produto}),e.jsxs(ge,{children:[o.preco_produto&&e.jsx("p",{style:{color:"#A87826"},children:Be(o.preco_produto)}),o.parcela_produto&&e.jsx("p",{style:{color:"#A87826"},children:Ee(o.parcela_produto)})]}),e.jsxs(je,{children:[e.jsx(J,{title:g[o.id_produto]?'Remover da lista "Amei"':'Adicionar à lista "Amei"',onClick:()=>g[o.id_produto]?Z(o.id_produto):Y(o),children:g[o.id_produto]?e.jsx(Se,{}):e.jsx(ke,{})}),e.jsx(J,{title:'Adicionar ao ""meu carrinho"',children:e.jsx(ye,{})})]}),o.qtd_produto===0?e.jsx(fe,{style:{background:"#FFF",color:"#A87826"},children:"Avise quando chegar"}):e.jsx(be,{to:`/produto/${o.nome_produto}`,children:"Detalhes do produto"})]})]},o.id_produto)):e.jsx("p",{children:"Nenhum produto encontrado com os filtros aplicados."}),e.jsxs(Fe,{children:[e.jsx(O,{disabled:u===1,onClick:()=>N(u-1),children:"Anterior"}),e.jsxs(ae,{children:["Página ",u," de ",D]}),e.jsx(O,{disabled:u===D,onClick:()=>N(u+1),children:"Próxima"})]})]})})]})]})}export{qe as P};
