import{a as s,m as so,j as o,C as io,k as f,g as j}from"./GlobalStyles-Dqpp29B9.js";import{d as no,e as co,f as lo,g as uo,D as po,h as u,i as ho,j as mo,k as q,l as _o,m as y,n as xo,U as go,o as fo,p as jo,q as Ao,r as vo,C as So,B as R}from"./ProdutoStyles-CJ63-lzv.js";import{B as U}from"./HomePageStyles-CJMC4Gvw.js";import{a as d}from"./axios-DnYME9kn.js";import{U as bo}from"./userContext-D66xfPlX.js";import{a as yo,T as Co,c as Fo,b as ko}from"./index-CJGrLZTX.js";import{f as p,b as Eo,a as Po}from"./Functions-CUekD-7M.js";import{M as $o}from"./ModalAvisar-Y_GjLJ4T.js";import{d as Lo}from"./ModalsStyles-CkMaqKjX.js";import{F as P,B as H}from"./ContaUserStyles-jzYrjlID.js";import{d as V,e as G}from"./ProdutosStyle-8Z2-wOEa.js";import{a as wo,d as Bo}from"./index-CmN5j4cY.js";function zo(){const{user:i}=s.useContext(bo),[A,Mo]=s.useState({}),[v,Do]=s.useState({}),{nome_produto:$}=so(),[e,Q]=s.useState([]);s.useState([]);const[z,W]=s.useState([]),[C,L]=s.useState(""),[S,K]=s.useState(null),[w,X]=s.useState(!1),[B,Y]=s.useState(!1),[m,F]=s.useState({}),[c,k]=s.useState({}),[b,Z]=s.useState([]),[h,M]=s.useState(1),_=5,D=(h-1)*_,oo=D+_,E=b.slice(D,oo),eo=14;s.useEffect(()=>{(async()=>{try{const a=await d.get(`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/produto/nome/${$}`);Q(a.data.result)}catch(a){console.error("Erro ao buscar dados do produto.",a)}})()},[$]),s.useEffect(()=>{if(i&&i.id_user){const a=(JSON.parse(localStorage.getItem(`listaAmei_${i.id_user}`))||[]).reduce((t,n)=>(t[n.id_produto]=!0,t),{});F(a)}},[i]),s.useEffect(()=>{if(i&&i.id_user){const a=(JSON.parse(localStorage.getItem(`carrinho${i.id_user}`))||[]).reduce((t,n)=>(t[n.id_produto]=!0,t),{});k(a)}},[i]),s.useEffect(()=>{const r=async()=>{try{const t=await d.get(`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/pedido/avaliacao-produto/${e.id_produto}`);Z(t.data.result)}catch(t){console.error("Erro ao listar avaliações",t)}},a=async()=>{try{const t=await d.get("https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/usuarios");W(t.data.result)}catch{setError("Erro ao obter dados dos clientes."),setSuccess("")}};r(),a()},[e.id_produto]);const ro=async r=>{const a=i.id_user;if(!a){alert('Você precisa estar logado para adicionar à lista "Amei".');return}try{const t=JSON.parse(localStorage.getItem(`listaAmei_${a}`))||[];if(t.some(g=>g.id_produto===r.id_produto)||(await d.get(`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/lista-amei/${a}`)).data.some(g=>g.id_produto===r.id_produto))return;const l=await d.post("https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/lista-amei",{id_user:a,id_produto:r.id_produto});if(l.status!==200&&l.status!==201)throw new Error('Erro ao adicionar o produto à lista "Amei".');t.push(r),localStorage.setItem(`listaAmei_${a}`,JSON.stringify(t)),F(g=>({...g,[r.id_produto]:!0}))}catch(t){console.error('Erro ao adicionar à lista "Amei":',t.response?t.response.data:t.message),alert("Erro ao adicionar o produto à lista.")}},to=async r=>{try{const a=i.id_user;await d.delete(`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/lista-amei/${a}/${r}`);const n=(JSON.parse(localStorage.getItem(`listaAmei_${a}`))||[]).filter(x=>x.id_produto!==r);localStorage.setItem(`listaAmei_${a}`,JSON.stringify(n)),F(x=>({...x,[r]:!1}))}catch(a){console.error('Erro ao remover produto da lista "Amei":',a),alert("Erro ao remover o produto da lista.")}},I=async r=>{const a=i.id_user;if(!i||!i.id_user){alert("Você precisa estar logado para adicionar ao carrinho.");return}try{const t=JSON.parse(localStorage.getItem(`carrinho${a}`))||[];if(t.some(l=>l.id_produto===r.id_produto)||(await d.get(`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/carrinho/${a}`)).data.some(l=>l.id_produto===r.id_produto))return;await d.post("https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/carrinho",{id_user:a,id_produto:r.id_produto,qtd_produto_carrinho:1}),t.push(r),localStorage.setItem(`carrinho${a}`,JSON.stringify(t)),k(l=>({...l,[r.id_produto]:!0}))}catch(t){console.error("Erro ao adicionar ao carrinho:",t),alert("Erro ao adicionar o produto no carrinho.")}},N=async r=>{try{await d.delete(`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/carrinho/${i.id_user}/${r}`);const t=(JSON.parse(localStorage.getItem(`carrinho${i.id_user}`))||[]).filter(n=>n.id_produto!==r);localStorage.setItem(`carrinho${i.id_user}`,JSON.stringify(t)),k(n=>({...n,[r]:!1}))}catch(a){console.error("Erro ao remover produto do carrinho:",a),alert("Erro ao remover o produto do carrinho.")}},O=(r,a)=>{},J=(r,a)=>{},T=r=>{K(r),X(!w)},ao=async r=>{r.preventDefault(),Y(!0);const a={email_user:C,nome_produto:S.nome_produto};try{const t=await d.post(`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/aviso/${S.nome_produto}`,a);t.status===200&&t.data.message==="E-mail enviado com sucesso!"?(alert("E-mail enviado com sucesso!"),L("")):alert(t.data.message||"Erro ao enviar e-mail.")}catch(t){console.error(t),(!t.response||t.response.status>=500)&&alert("Erro ao enviar e-mail.")}};return o.jsxs(io,{children:[o.jsx(no,{children:e.nome_produto}),o.jsxs(co,{children:[o.jsxs(lo,{children:[o.jsx(uo,{src:e.img_produto,alt:e.nome_produto}),o.jsxs(po,{children:[o.jsx(f,{children:e.nome_produto}),e.categoria_produto==="promocoes"?o.jsxs("div",{children:[o.jsx(u,{style:{textDecoration:"line-through"},children:p(e.preco_produto)}),o.jsx(u,{style:{color:"#A87826"},children:p(e.preco_promocional_produto)})]}):o.jsx(u,{children:p(e.preco_produto)}),o.jsx(j,{children:Eo(e.parcela_produto)}),o.jsxs(j,{children:["Quantidade restante: ",e.qtd_produto]}),e.qtd_produto===0?o.jsxs(ho,{children:[o.jsx("p",{children:"Produto indisponível"}),o.jsx(U,{style:{background:"#FFF",color:"#A87826"},onClick:r=>{r.stopPropagation(),T(e)},children:"Avise quando chegar"})]}):o.jsxs(mo,{children:[o.jsxs(q,{title:m[e.id_produto]?'Remover da lista "Amei"':'Adicionar à lista "Amei"',onClick:()=>m[e.id_produto]?to(e.id_produto):ro(e),onMouseEnter:()=>O(e.id_produto),onMouseLeave:()=>J(e.id_produto),style:{background:m[e.id_produto]?(A[e.id_produto],"#FFF"):A[e.id_produto]?"#FFF":"#A87826",color:m[e.id_produto]?(A[e.id_produto],"#A87826"):A[e.id_produto]?"#A87826":"#FFF"},children:[m[e.id_produto]?o.jsx(yo,{}):o.jsx(Co,{}),"Amei"]}),o.jsxs(q,{title:c[e.id_produto]?"Remover do carrinho":"Adicionar ao carrinho",onClick:()=>c[e.id_produto]?N(e.id_produto):I(e),onMouseEnter:()=>O(e.id_produto),onMouseLeave:()=>J(e.id_produto),style:{background:c[e.id_produto]?(v[e.id_produto],"#FFF"):v[e.id_produto]?"#FFF":"#A87826",color:c[e.id_produto]?(v[e.id_produto],"#A87826"):v[e.id_produto]?"#A87826":"#FFF"},children:[c[e.id_produto]?o.jsx(Fo,{}):o.jsx(ko,{}),"Carrinho"]})]})]})]}),o.jsxs(_o,{children:[o.jsxs(y,{children:[o.jsx(f,{children:"Preço do produto:"}),e.categoria_produto==="promocoes"?o.jsxs("div",{children:[o.jsx(u,{style:{textDecoration:"line-through"},children:p(e.preco_produto)}),o.jsx(u,{style:{color:"#A87826"},children:p(e.preco_promocional_produto)})]}):o.jsx(u,{children:p(e.preco_produto)})]}),o.jsxs(y,{children:[o.jsx(f,{children:"Frete:"}),o.jsxs(y,{children:[o.jsxs(u,{children:["Grande Florianópolis: ",p(eo)]}),o.jsx(u,{children:"Resto do Brasil: Necessário calcular."})]})]}),e.qtd_produto>0?o.jsx(y,{children:o.jsx(U,{title:c[e.id_produto]?"Remover do carrinho":"Adicionar no carrinho",onClick:()=>c[e.id_produto]?N(e.id_produto):I(e),children:c[e.id_produto]?"Remover do carrinho":"Adicionar ao carrinho"})}):o.jsx(j,{children:"Produto indisponível"})]})]}),w&&o.jsx($o,{children:o.jsxs(Lo,{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[o.jsx(f,{children:"Preencha os campos"}),o.jsxs(P,{children:[o.jsx(V,{children:o.jsx(wo,{})}),o.jsx(G,{type:"email",placeholder:"E-mail",value:C,onChange:r=>L(r.target.value)})]}),S&&o.jsxs(P,{children:[o.jsx(V,{children:o.jsx(Bo,{})}),o.jsx(G,{type:"text",value:S.nome_produto,readOnly:!0})]}),o.jsxs(P,{children:[o.jsx(H,{type:"submit",onClick:ao,disabled:B||!C,style:{width:"10rem"},children:B?"Enviando...":"Enviar"}),o.jsx(H,{onClick:T,style:{width:"10rem"},children:"Fechar"})]})]})}),o.jsxs(xo,{children:[o.jsx(f,{children:"Avaliações do produto"}),Array.isArray(E)&&E.length>0?E.map(r=>{const a=z.find(n=>n.id_user===r.id_user),t=a?a.nome_user:"Cliente não encontrado";return o.jsxs(go,{children:[o.jsx(j,{children:t}),o.jsxs(fo,{children:["Avaliação realizada em: ",Po(r.data_avaliacao)]}),o.jsxs(jo,{children:[o.jsx("div",{children:[1,2,3,4,5].map(n=>o.jsx(Ao,{$filled:n<=r.nivel_avaliacao,children:"★"},n))}),o.jsx(vo,{style:{fontWeight:"600"},children:r.titulo_avaliacao}),o.jsx(j,{children:r.descricao_avaliacao})]})]},r.id_avaliacao)}):o.jsx("p",{children:"Este produto ainda não possui avaliações"}),b.length>_&&o.jsxs(So,{children:[o.jsx(R,{disabled:h===1,onClick:()=>M(h-1),children:"Anterior"}),o.jsxs("span",{children:["Página ",h," de ",Math.ceil(b.length/_)]}),o.jsx(R,{disabled:h===Math.ceil(b.length/_),onClick:()=>M(h+1),children:"Próxima"})]})]})]})}export{zo as P};
