import{a as s,f as C,j as R}from"./GlobalStyles-Dqpp29B9.js";import{a as g}from"./axios-DnYME9kn.js";const f=s.createContext(),L=({children:p})=>{const[E,r]=s.useState(""),[S,o]=s.useState(!1),[I,i]=s.useState(!0),[U,a]=s.useState(null),[h,c]=s.useState(null),k=C(),A=()=>h==="admin",y=()=>h==="user";s.useEffect(()=>{(async()=>{var t;i(!0);try{const u=localStorage.getItem("token");if(u){const l=await g.get("https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/auth/check",{withCredentials:!0,headers:{Authorization:`Bearer ${u}`}});if((t=l.data)!=null&&t.authenticated){const d=localStorage.getItem("userEmail")||l.data.email;r(d),o(!0),await n(d)}else r(""),o(!1),a(null)}else{const l=localStorage.getItem("isAuthenticated")==="true";if(o(l),l){const m=localStorage.getItem("userEmail");r(m),await n(m)}else r(""),a(null)}}catch(u){console.error("Erro ao verificar autenticação:",u),r(""),o(!1),a(null)}finally{i(!1)}})()},[]),s.useEffect(()=>{const e=localStorage.getItem("isAuthenticated")==="true";o(e)},[]);const n=async e=>{try{const t=await g.get(`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/usuario/mail/${e}`);t.data.result.length>0?(a(t.data.result[0]),c(t.data.result[0].funcao_user)):(a(null),c(null))}catch{a(null),c(null)}finally{i(!1)}},b=async e=>{try{await n(e),r(e),o(!0),localStorage.setItem("userEmail",e),localStorage.setItem("isAuthenticated","true")}catch(t){console.error("Erro ao fazer login:",t),a(null),o(!1),localStorage.removeItem("isAuthenticated")}},v=e=>{r(e),localStorage.setItem("userEmail",e)},x=e=>{a(t=>({...t,...e}))},w=async()=>{try{await g.post("https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/auth/logout",{},{withCredentials:!0}),r(""),o(!1),a(null),c(null),localStorage.removeItem("userEmail"),localStorage.removeItem("isAuthenticated"),k("/login")}catch(e){console.error("Erro ao fazer logout",e)}};return R.jsx(f.Provider,{value:{user:U,userEmail:E,isAuthenticated:S,isLoading:I,userRole:h,login:b,logout:w,setUserEmail:v,updateUser:x,fetchUserData:n,isUserAdmin:A,isUserRegular:y},children:p})};function P(){return s.useContext(f)}export{f as U,L as a,P as u};
