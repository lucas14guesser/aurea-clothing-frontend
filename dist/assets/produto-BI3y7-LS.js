import{a as s,m as io,j as o,C as no,k as f,g as b}from"./GlobalStyles-Dqpp29B9.js";import{d as co,e as lo,f as uo,g as po,D as ho,h as u,U as mo,i as m,j as _o,k as xo,l as q,m as go,n as y,o as jo,p as fo,q as bo,r as Ao,s as vo,t as ko,C as So,B as R}from"./ProdutoStyles-Cz6hDj1C.js";import{B as V}from"./HomePageStyles-CJMC4Gvw.js";import{a as c}from"./axios-DnYME9kn.js";import{U as yo}from"./userContext-D66xfPlX.js";import{a as Co,T as Fo,c as Eo,b as $o}from"./index-CJGrLZTX.js";import{f as p,b as Po,a as Lo}from"./Functions-BNM27soa.js";import{M as wo}from"./ModalAvisar-Y_GjLJ4T.js";import{d as Bo}from"./ModalsStyles-CkMaqKjX.js";import{F as P,B as H}from"./ContaUserStyles-jzYrjlID.js";import{d as G,e as Q}from"./ProdutosStyle-8Z2-wOEa.js";import{a as Io,d as Mo}from"./index-CmN5j4cY.js";function Ko(){const{user:i}=s.useContext(yo),[A,Do]=s.useState({}),[v,No]=s.useState({}),{nome_produto:L}=io(),[e,z]=s.useState([]);s.useState([]);const[W,K]=s.useState([]),[C,w]=s.useState(""),[k,X]=s.useState(null),[B,Y]=s.useState(!1),[I,Z]=s.useState(!1),[_,F]=s.useState({}),[d,E]=s.useState({}),[S,oo]=s.useState([]),[h,M]=s.useState(1),x=5,D=(h-1)*x,eo=D+x,$=S.slice(D,eo),ro=14;s.useEffect(()=>{(async()=>{try{const a=await c.get(`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/produto/nome/${L}`);z(a.data.result)}catch(a){console.error("Erro ao buscar dados do produto.",a)}})()},[L]),s.useEffect(()=>{if(i&&i.id_user){const a=(JSON.parse(localStorage.getItem(`listaAmei_${i.id_user}`))||[]).reduce((t,n)=>(t[n.id_produto]=!0,t),{});F(a)}},[i]),s.useEffect(()=>{if(i&&i.id_user){const a=(JSON.parse(localStorage.getItem(`carrinho${i.id_user}`))||[]).reduce((t,n)=>(t[n.id_produto]=!0,t),{});E(a)}},[i]),s.useEffect(()=>{const r=async()=>{try{const t=await c.get(`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/pedido/avaliacao-produto/${e.id_produto}`);oo(t.data.result)}catch(t){console.error("Erro ao listar avaliações",t)}},a=async()=>{try{const t=await c.get("https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/usuarios");K(t.data.result)}catch{setError("Erro ao obter dados dos clientes."),setSuccess("")}};r(),a()},[e.id_produto]);const to=async r=>{const a=i.id_user;if(!a){alert('Você precisa estar logado para adicionar à lista "Amei".');return}try{const t=JSON.parse(localStorage.getItem(`listaAmei_${a}`))||[];if(t.some(j=>j.id_produto===r.id_produto)||(await c.get(`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/lista-amei/${a}`)).data.some(j=>j.id_produto===r.id_produto))return;const l=await c.post("https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/lista-amei",{id_user:a,id_produto:r.id_produto});if(l.status!==200&&l.status!==201)throw new Error('Erro ao adicionar o produto à lista "Amei".');t.push(r),localStorage.setItem(`listaAmei_${a}`,JSON.stringify(t)),F(j=>({...j,[r.id_produto]:!0}))}catch(t){console.error('Erro ao adicionar à lista "Amei":',t.response?t.response.data:t.message),alert("Erro ao adicionar o produto à lista.")}},ao=async r=>{try{const a=i.id_user;await c.delete(`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/lista-amei/${a}/${r}`);const n=(JSON.parse(localStorage.getItem(`listaAmei_${a}`))||[]).filter(g=>g.id_produto!==r);localStorage.setItem(`listaAmei_${a}`,JSON.stringify(n)),F(g=>({...g,[r]:!1}))}catch(a){console.error('Erro ao remover produto da lista "Amei":',a),alert("Erro ao remover o produto da lista.")}},N=async r=>{const a=i.id_user;if(!i||!i.id_user){alert("Você precisa estar logado para adicionar ao carrinho.");return}try{const t=JSON.parse(localStorage.getItem(`carrinho${a}`))||[];if(t.some(l=>l.id_produto===r.id_produto)||(await c.get(`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/carrinho/${a}`)).data.some(l=>l.id_produto===r.id_produto))return;await c.post("https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/carrinho",{id_user:a,id_produto:r.id_produto,qtd_produto_carrinho:1}),t.push(r),localStorage.setItem(`carrinho${a}`,JSON.stringify(t)),E(l=>({...l,[r.id_produto]:!0}))}catch(t){console.error("Erro ao adicionar ao carrinho:",t),alert("Erro ao adicionar o produto no carrinho.")}},O=async r=>{try{await c.delete(`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/carrinho/${i.id_user}/${r}`);const t=(JSON.parse(localStorage.getItem(`carrinho${i.id_user}`))||[]).filter(n=>n.id_produto!==r);localStorage.setItem(`carrinho${i.id_user}`,JSON.stringify(t)),E(n=>({...n,[r]:!1}))}catch(a){console.error("Erro ao remover produto do carrinho:",a),alert("Erro ao remover o produto do carrinho.")}},J=(r,a)=>{},T=(r,a)=>{},U=r=>{X(r),Y(!B)},so=async r=>{r.preventDefault(),Z(!0);const a={email_user:C,nome_produto:k.nome_produto};try{const t=await c.post(`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/aurea/aviso/${k.nome_produto}`,a);t.status===200&&t.data.message==="E-mail enviado com sucesso!"?(alert("E-mail enviado com sucesso!"),w("")):alert(t.data.message||"Erro ao enviar e-mail.")}catch(t){console.error(t),(!t.response||t.response.status>=500)&&alert("Erro ao enviar e-mail.")}};return o.jsxs(no,{children:[o.jsx(co,{children:e.nome_produto}),o.jsxs(lo,{children:[o.jsxs(uo,{children:[o.jsx(po,{src:`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/uploads/${e.img_produto}`,alt:e.nome_produto}),o.jsxs(ho,{children:[o.jsx(f,{children:e.nome_produto}),e.categoria_produto==="promocoes"?o.jsxs("div",{children:[o.jsx(u,{style:{textDecoration:"line-through"},children:p(e.preco_produto)}),o.jsx(u,{style:{color:"#A87826"},children:p(e.preco_promocional_produto)})]}):o.jsx(u,{children:p(e.preco_produto)}),o.jsx(b,{children:Po(e.parcela_produto)}),o.jsxs(b,{children:["Quantidade restante: ",e.qtd_produto]}),o.jsxs(mo,{children:[o.jsx("li",{children:o.jsx(m,{src:`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/uploads/${e.img_produto}`,alt:e.nome_produto})}),o.jsx("li",{children:o.jsx(m,{src:`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/uploads/${e.img_produto}`,alt:e.nome_produto})}),o.jsx("li",{children:o.jsx(m,{src:`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/uploads/${e.img_produto}`,alt:e.nome_produto})}),o.jsx("li",{children:o.jsx(m,{src:`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/uploads/${e.img_produto}`,alt:e.nome_produto})}),o.jsx("li",{children:o.jsx(m,{src:`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/uploads/${e.img_produto}`,alt:e.nome_produto})}),o.jsx("li",{children:o.jsx(m,{src:`https://test-aureaclothing-backend-466bc65ebfec.herokuapp.com/uploads/${e.img_produto}`,alt:e.nome_produto})})]}),e.qtd_produto===0?o.jsxs(_o,{children:[o.jsx("p",{children:"Produto indisponível"}),o.jsx(V,{style:{background:"#FFF",color:"#A87826"},onClick:r=>{r.stopPropagation(),U(e)},children:"Avise quando chegar"})]}):o.jsxs(xo,{children:[o.jsxs(q,{title:_[e.id_produto]?'Remover da lista "Amei"':'Adicionar à lista "Amei"',onClick:()=>_[e.id_produto]?ao(e.id_produto):to(e),onMouseEnter:()=>J(e.id_produto),onMouseLeave:()=>T(e.id_produto),style:{background:_[e.id_produto]?(A[e.id_produto],"#FFF"):A[e.id_produto]?"#FFF":"#A87826",color:_[e.id_produto]?(A[e.id_produto],"#A87826"):A[e.id_produto]?"#A87826":"#FFF"},children:[_[e.id_produto]?o.jsx(Co,{}):o.jsx(Fo,{}),"Amei"]}),o.jsxs(q,{title:d[e.id_produto]?"Remover do carrinho":"Adicionar ao carrinho",onClick:()=>d[e.id_produto]?O(e.id_produto):N(e),onMouseEnter:()=>J(e.id_produto),onMouseLeave:()=>T(e.id_produto),style:{background:d[e.id_produto]?(v[e.id_produto],"#FFF"):v[e.id_produto]?"#FFF":"#A87826",color:d[e.id_produto]?(v[e.id_produto],"#A87826"):v[e.id_produto]?"#A87826":"#FFF"},children:[d[e.id_produto]?o.jsx(Eo,{}):o.jsx($o,{}),"Carrinho"]})]})]})]}),o.jsxs(go,{children:[o.jsxs(y,{children:[o.jsx(f,{children:"Preço do produto:"}),e.categoria_produto==="promocoes"?o.jsxs("div",{children:[o.jsx(u,{style:{textDecoration:"line-through"},children:p(e.preco_produto)}),o.jsx(u,{style:{color:"#A87826"},children:p(e.preco_promocional_produto)})]}):o.jsx(u,{children:p(e.preco_produto)})]}),o.jsxs(y,{children:[o.jsx(f,{children:"Frete:"}),o.jsxs(y,{children:[o.jsxs(u,{children:["Grande Florianópolis: ",p(ro)]}),o.jsx(u,{children:"Resto do Brasil: Necessário calcular."})]})]}),e.qtd_produto>0?o.jsx(y,{children:o.jsx(V,{title:d[e.id_produto]?"Remover do carrinho":"Adicionar no carrinho",onClick:()=>d[e.id_produto]?O(e.id_produto):N(e),children:d[e.id_produto]?"Remover do carrinho":"Adicionar ao carrinho"})}):o.jsx(b,{children:"Produto indisponível"})]})]}),B&&o.jsx(wo,{children:o.jsxs(Bo,{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[o.jsx(f,{children:"Preencha os campos"}),o.jsxs(P,{children:[o.jsx(G,{children:o.jsx(Io,{})}),o.jsx(Q,{type:"email",placeholder:"E-mail",value:C,onChange:r=>w(r.target.value)})]}),k&&o.jsxs(P,{children:[o.jsx(G,{children:o.jsx(Mo,{})}),o.jsx(Q,{type:"text",value:k.nome_produto,readOnly:!0})]}),o.jsxs(P,{children:[o.jsx(H,{type:"submit",onClick:so,disabled:I||!C,style:{width:"10rem"},children:I?"Enviando...":"Enviar"}),o.jsx(H,{onClick:U,style:{width:"10rem"},children:"Fechar"})]})]})}),o.jsxs(jo,{children:[o.jsx(f,{children:"Avaliações do produto"}),Array.isArray($)&&$.length>0?$.map(r=>{const a=W.find(n=>n.id_user===r.id_user),t=a?a.nome_user:"Cliente não encontrado";return o.jsxs(fo,{children:[o.jsx(b,{children:t}),o.jsxs(bo,{children:["Avaliação realizada em: ",Lo(r.data_avaliacao)]}),o.jsxs(Ao,{children:[o.jsx("div",{children:[1,2,3,4,5].map(n=>o.jsx(vo,{$filled:n<=r.nivel_avaliacao,children:"★"},n))}),o.jsx(ko,{style:{fontWeight:"600"},children:r.titulo_avaliacao}),o.jsx(b,{children:r.descricao_avaliacao})]})]},r.id_avaliacao)}):o.jsx("p",{children:"Este produto ainda não possui avaliações"}),S.length>x&&o.jsxs(So,{children:[o.jsx(R,{disabled:h===1,onClick:()=>M(h-1),children:"Anterior"}),o.jsxs("span",{children:["Página ",h," de ",Math.ceil(S.length/x)]}),o.jsx(R,{disabled:h===Math.ceil(S.length/x),onClick:()=>M(h+1),children:"Próxima"})]})]})]})}export{Ko as P};
