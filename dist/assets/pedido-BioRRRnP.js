import{a as r,m as A,j as e,R as $,T as p,k as x,g,p as S}from"./GlobalStyles-Dqpp29B9.js";import{a as c}from"./axios-DnYME9kn.js";import{R as y,M as L,L as m,B as z,C as F,a as I}from"./UserDashboardStyles-BUujLACN.js";import{C as N,a as D,b as j,T as s,F as E}from"./PedidosAdminStyle-Ddg4UkdS.js";import{I as O,a as V}from"./index-CVGnD8mp.js";import{U as G}from"./userContext-Hfd7AKwO.js";import{a as Q,f as k}from"./Functions-BNM27soa.js";import{S as W}from"./SpinnerComponent-D-z1JUIS.js";function oe(){const{user:f,logout:M}=r.useContext(G),{id_pedido:a}=A(),[d,P]=r.useState([]),[l,b]=r.useState([]),[i,w]=r.useState([]),[B,R]=r.useState(!0),[u,T]=r.useState([]),[h,U]=r.useState(!1),_=()=>{U(!h)},C=async()=>{const t=d.status_pedido==="em andamento"?"encerrado":"em andamento";try{(await c.put(`http://localhost:3001/aurea/pedido/${a}`,{status_pedido:t})).data.result?(alert(`O status do pedido foi alterado para "${t}".`),P(n=>({...n,status_pedido:t}))):alert("Não foi possível alterar o status do pedido.")}catch(o){console.error("Erro ao atualizar o status do pedido:",o),alert("Ocorreu um erro ao tentar atualizar o status do pedido.")}};return r.useEffect(()=>{(async()=>{try{const o=await c.get(`http://localhost:3001/aurea/pedido/${a}`);if(P(o.data.result),o.data.result){const n=await c.get(`http://localhost:3001/aurea/usuario/${o.data.result.id_user}`);w(n.data.result)}}catch(o){console.error("Erro ao buscar pedido.",o)}finally{R(!1)}})()},[a]),r.useEffect(()=>{a&&(async()=>{try{const o=await c.get(`http://localhost:3001/aurea/produto/pedido/${a}`);b(o.data.result)}catch(o){console.error("Erro ao buscar produtos.",o)}})()},[a]),r.useEffect(()=>{a&&(async()=>{try{const o=await c.get(`http://localhost:3001/aurea/itens-pedido/${a}`);T(o.data.result)}catch(o){console.error("Erro ao buscar produtos.",o)}})()},[a]),B?e.jsx(W,{}):d?e.jsxs($.Fragment,{children:[h?e.jsxs(y,{children:[e.jsx(O,{style:{fontSize:"2rem",color:"#A87826",cursor:"pointer"},onClick:_}),e.jsxs(p,{children:["Boas-vindas, ",f.nome_user]})]}):e.jsxs(y,{children:[e.jsx(V,{style:{fontSize:"2rem",color:"#A87826",cursor:"pointer"},onClick:_}),e.jsxs(p,{children:["Boas-vindas, ",f.nome_user]})]}),h&&e.jsxs(L,{children:[e.jsx(m,{to:"/minha-conta",children:"Minha Conta"}),e.jsx(m,{to:"/pedidos-ativos",children:"Pedidos Ativos"}),e.jsx(m,{to:"/pedidos-encerrados",children:"Pedidos Encerrados"}),e.jsx(z,{onClick:M,children:"Sair"})]}),e.jsx(F,{children:e.jsxs(N,{style:{marginTop:"2rem"},children:[e.jsx(p,{children:"Detalhes do pedido"}),e.jsxs(D,{children:[e.jsxs(j,{children:[e.jsx(x,{children:"Pedido"}),e.jsxs(s,{children:["Pedido: ",d.id_pedido]}),e.jsxs(s,{children:["Data: ",Q(d.data_pedido)]}),e.jsxs(s,{children:["Endereço: ",d.endereco_pedido]}),e.jsxs(s,{children:["Pagamento: ",d.pagamento_pedido]}),e.jsxs(s,{children:["Status: ",d.status_pedido]})]}),e.jsxs(j,{children:[e.jsx(x,{children:"Cliente"}),e.jsxs(s,{children:["ID do cliente: ",i.id_user]}),e.jsxs(s,{children:["Nome: ",i.nome_user]}),e.jsxs(s,{children:["Sobrenome: ",i.sobrenome_user]}),e.jsxs(s,{children:["Telefone: ",i.telefone_user]}),e.jsxs(s,{children:["E-mail: ",i.email_user]})]})]}),e.jsx(D,{children:l&&l.length>0?l.map((t,o)=>e.jsxs(j,{children:[e.jsx(x,{children:"Produto"}),e.jsxs(s,{children:["ID do produto: ",t.id_produto]}),e.jsxs(s,{children:["Nome: ",t.nome_produto]}),e.jsxs(s,{children:["Categoria: ",t.categoria_produto]}),e.jsxs(s,{children:["Cor: ",t.cor_produto]}),t.categoria_produto==="promocoes"?e.jsxs(s,{children:["Preço: ",k(t.preco_promocional_produto)]}):e.jsxs(s,{children:["Preço: ",k(t.preco_produto)]}),u&&u.length>0?u.filter(n=>n.id_produto===t.id_produto).map((n,v)=>e.jsxs(s,{children:["Quantidade: ",n.qtd_produto]},v)):e.jsx(g,{children:"Quantidade: Sem dados"})]},o)):e.jsx(g,{children:"Dados do produto não carregados"})}),d.status_pedido==="em andamento"?e.jsxs(E,{children:[e.jsx(I,{style:{textAlign:"center"},onClick:C,children:"Encerrar Pedido"}),e.jsx(S,{to:"/pedidos-ativos",style:{maxWidth:"100%"},children:"Voltar para todos os pedidos ativos"})]}):e.jsxs(E,{children:[e.jsx(I,{style:{textAlign:"center"},onClick:C,children:"Reabrir Pedido"}),e.jsx(S,{to:"/pedidos-encerrados",style:{maxWidth:"100%"},children:"Voltar para todos os pedidos encerrados"})]})]})})]}):e.jsx("p",{children:"Pedido não encontrado"})}export{oe as P};
